<!-- FULL PRODUCTION-READY DASHBOARD CODE REPLACED COMPLETELY -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NYLA GENERAL SUPPLIES LTD — Projects Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Inter;background:#0b1220;color:#e6eef8;padding:0;}
.wrapper{display:flex;min-height:100vh;}
.sidebar{width:300px;background:#0f172a;padding:20px;overflow-y:auto;}
.sidebar h2{margin:0 0 10px;font-size:18px;font-weight:800;}
.project-card{background:#1e293b;padding:12px;border-radius:8px;margin-bottom:10px;cursor:pointer;border:1px solid transparent;}
.project-card.active{border-color:#0ea5a4;background:#123548;}
.project-title{font-weight:700;font-size:14px;}
.units{margin-top:8px;border-top:1px dashed #334155;padding-top:6px;display:none;}
.unit{padding:6px;border-radius:6px;background:#0f1a2b;margin-top:6px;cursor:pointer;}
.unit.active{background:#0ea5a4;color:#02131f;}
.main{flex:1;padding:20px;overflow-y:auto;}
.top-header{display:flex;justify-content:space-between;align-items:center;}
.kpi{display:flex;gap:12px;margin-top:12px;}
.kpi-box{background:#1e293b;padding:14px;border-radius:10px;min-width:160px;}
.kpi-label{font-size:12px;color:#94a3b8;}
.kpi-value{font-size:18px;font-weight:800;margin-top:4px;}
.categories{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:20px;}
.cat{background:#1e293b;padding:12px;border-radius:10px;}
.progress{height:8px;background:#334155;border-radius:4px;margin-top:6px;overflow:hidden;}
.progress span{display:block;height:8px;background:#0ea5ff;}
.ledger{margin-top:20px;}
table{width:100%;border-collapse:collapse;font-size:13px;}
th{color:#94a3b8;border-bottom:1px solid #334155;padding:8px;text-align:left;}
td{padding:8px;border-bottom:1px dashed #334155;}
.btn{background:#0ea5a4;padding:8px 16px;border:none;border-radius:8px;color:#02131f;font-weight:700;cursor:pointer;}
.btn.ghost{background:transparent;border:1px solid #334155;color:#94a3b8;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px;}
.modal-box{background:#0f172a;padding:20px;border-radius:10px;width:500px;}
.input,select{width:100%;padding:8px;border-radius:6px;background:#1e293b;border:1px solid #334155;color:#e6eef8;margin-top:8px;}
</style>
</head>
<body>
<div class="wrapper">
  <div class="sidebar">
    <h2>NYLA PROJECTS</h2>
    <div id="projects"></div>
  </div>
  <div class="main">
    <div class="top-header">
        <h1 id="schoolName">Select a project</h1>
        <button class="btn" id="addExpense">Add Expense</button>
    </div>

    <div class="kpi">
      <div class="kpi-box"><div class="kpi-label">Contract Value</div><div class="kpi-value" id="contractValue">-</div></div>
      <div class="kpi-box"><div class="kpi-label">Net Available</div><div class="kpi-value" id="netAvailable">-</div></div>
      <div class="kpi-box"><div class="kpi-label">Total Spent</div><div class="kpi-value" id="totalSpent">-</div></div>
      <div class="kpi-box"><div class="kpi-label">Remaining</div><div class="kpi-value" id="remaining">-</div></div>
    </div>

    <h3 style="margin-top:20px">Budget Categories</h3>
    <div class="categories" id="categories"></div>

    <h3 style="margin-top:20px">Expense Ledger</h3>
    <table>
      <thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Unit</th><th>Amount</th></tr></thead>
      <tbody id="ledger"></tbody>
    </table>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Add Expense</h3>
    <select id="expCategory"></select>
    <input type="date" id="expDate" class="input" />
    <input type="text" id="expUnit" class="input" placeholder="unit1 / unit2" />
    <input type="number" id="expAmount" class="input" placeholder="Amount" />
    <input type="text" id="expDesc" class="input" placeholder="Description" />
    <button class="btn" id="saveExpense" style="margin-top:10px">Save</button>
  </div>
</div>

<script>
// FULL JAVASCRIPT — ALL 4 PROJECTS, BOTH UNITS, LEDGER, BUDGETS, CLICK HANDLING, CATEGORY CALCULATION

const data={projects:[
 {id:'yedhi',name:'YEDHI PRIMARY (2 units)',contract:1029000,net:524790,units:['unit1','unit2']},
 {id:'sogorosa',name:'SOGOROSA PRIMARY (2 units)',contract:1029000,net:524790,units:['unit1','unit2']},
 {id:'sosoni',name:'SOSONI PRIMARY (2 units)',contract:1546000,net:788460,units:['unit1','unit2']},
 {id:'mugumoni',name:'MUGUMONI PRIMARY (2 units)',contract:1546000,net:788460,units:['unit1','unit2']}
],
categories:[
 {key:'excavation',name:'Excavation',pct:12},
 {key:'concrete',name:'Concrete Works',pct:18},
 {key:'steel',name:'Reinforcement Steel',pct:5},
 {key:'pitwall',name:'Pit Walling',pct:20},
 {key:'superwall',name:'Superstructure Walling',pct:10},
 {key:'roofing',name:'Roofing',pct:12},
 {key:'doors',name:'Doors & Carpentry',pct:5},
 {key:'plaster',name:'Plaster & Screed',pct:6},
 {key:'painting',name:'Painting',pct:3},
 {key:'vent',name:'Ventilation',pct:2},
 {key:'transport',name:'Transport',pct:5},
 {key:'misc',name:'Miscellaneous',pct:2}
],
ledger:[]
};

let activeProject=null;
let activeUnit=null;

function renderProjects(){
 const container=document.getElementById('projects');
 container.innerHTML='';
 data.projects.forEach(p=>{
   const card=document.createElement('div');
   card.className='project-card';
   card.innerHTML=`<div class='project-title'>${p.name}</div>`;
   card.onclick=()=>{activeProject=p.id;activeUnit=null;renderUI();};
   if(activeProject===p.id) card.classList.add('active');
   
   const unitBox=document.createElement('div');
   unitBox.className='units';
   p.units.forEach(u=>{
     const div=document.createElement('div');
     div.className='unit'; div.textContent=u.toUpperCase();
     if(activeUnit===u) div.classList.add('active');
     div.onclick=(e)=>{e.stopPropagation(); activeProject=p.id; activeUnit=u; renderUI();};
     unitBox.appendChild(div);
   })
   if(activeProject===p.id) unitBox.style.display='block';
   card.appendChild(unitBox);
   container.appendChild(card);
 });
}

function format(n){return 'KSh '+Number(n).toLocaleString();}

function renderUI(){
 renderProjects();
 if(!activeProject){document.getElementById('schoolName').textContent='Select a project';return;}
 const proj=data.projects.find(p=>p.id===activeProject);
 document.getElementById('schoolName').textContent=proj.name+(activeUnit?' — '+activeUnit.toUpperCase():'');
 document.getElementById('contractValue').textContent=format(proj.contract);
 document.getElementById('netAvailable').textContent=format(proj.net);
 
 const filtered=data.ledger.filter(x=>x.project===activeProject && (!activeUnit||x.unit===activeUnit));
 const spent=filtered.reduce((s,x)=>s+Number(x.amount),0);
 document.getElementById('totalSpent').textContent=format(spent);
 document.getElementById('remaining').textContent=format(proj.net-spent);

 renderCategories(proj,filtered);
 renderLedger(filtered);
}

function renderCategories(proj,filtered){
 const box=document.getElementById('categories');
 box.innerHTML='';
 data.categories.forEach(c=>{
   const budget=Math.round(proj.net*(c.pct/100));
   const spent=filtered.filter(x=>x.category===c.key).reduce((s,x)=>s+Number(x.amount),0);
   const pct=Math.min(100,Math.round((spent/budget)*100));
   const div=document.createElement('div');
   div.className='cat';
   div.innerHTML=`
     <div style='font-weight:700;font-size:14px'>${c.name}</div>
     <div style='margin-top:6px'>Budget: ${format(budget)}</div>
     <div>Spent: ${format(spent)}</div>
     <div class='progress'><span style='width:${pct}%' ></span></div>
   `;
   box.appendChild(div);
 })
}

function renderLedger(rows){
 const tbody=document.getElementById('ledger');
 tbody.innerHTML='';
 rows.forEach(r=>{
   const tr=document.createElement('tr');
   tr.innerHTML=`
     <td>${r.date}</td><td>${r.category}</td><td>${r.desc}</td><td>${r.unit}</td><td>${format(r.amount)}</td>
   `;
   tbody.appendChild(tr);
 });
}

// expense modal
const modal=document.getElementById('modal');
document.getElementById('addExpense').onclick=()=>{
 if(!activeProject) return alert('Select a project first');
 const sel=document.getElementById('expCategory');
 sel.innerHTML='';
 data.categories.forEach(c=>{
   const o=document.createElement('option'); o.value=c.key; o.textContent=c.name; sel.appendChild(o);
 });
 modal.style.display='flex';
 document.getElementById('expDate').value=new Date().toISOString().substr(0,10);
};

document.getElementById('saveExpense').onclick=()=>{
 const rec={
   project:activeProject,
   unit:document.getElementById('expUnit').value||'',
   date:document.getElementById('expDate').value,
   category:document.getElementById('expCategory').value,
   amount:Number(document.getElementById('expAmount').value),
   desc:document.getElementById('expDesc').value
 };
 data.ledger.push(rec);
 modal.style.display='none';
 renderUI();
};

modal.onclick=(e)=>{if(e.target===modal) modal.style.display='none'};

renderUI();
</script>
</body>
</html>
